"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[993],{4211:(T,C,o)=>{o.d(C,{Xh:()=>p,wK:()=>h});const p="https://udify.app/chatbot/9FLUTdD0hszkzdTC",h=(()=>{try{return new URL(p).origin}catch{return"*"}})()},4885:(T,C,o)=>{o.d(C,{r:()=>_});var p=o(467),A=o(4412),h=o(7129),w=o(4438);let _=(()=>{class E{constructor(){this.templatesSubject=new A.t([]),this.templates$=this.templatesSubject.asObservable(),this.loadTemplates()}loadTemplates(){var e=this;return(0,p.A)(function*(){try{const s=(0,h.b)(),{data:n,error:i}=yield s.from("prompt_templates").select("*").order("display_order",{ascending:!0});if(i)throw i;e.templatesSubject.next(n||[])}catch(s){console.error("Error loading prompt templates:",s),console.warn("Loading fallback templates..."),e.templatesSubject.next(e.getFallbackTemplates())}})()}getFallbackTemplates(){return[{id:"fallback-1",name:"Hedge Analysis Template",family_type:"hedge_accounting",template_category:"analysis",description:"Basic hedge analysis template",prompt_text:"Analyze {{hedge_type}} effectiveness for {{entity}} covering {{currency}} exposure of {{amount}}.",input_fields:["hedge_type","entity","currency","amount"],status:"active",display_order:1},{id:"fallback-2",name:"Risk Assessment Template",family_type:"risk_management",template_category:"assessment",description:"Basic risk assessment template",prompt_text:"Assess {{risk_type}} risk for {{portfolio}} with exposure {{amount}} in {{currency}}.",input_fields:["risk_type","portfolio","amount","currency"],status:"active",display_order:2}]}addTemplate(e){var s=this;return(0,p.A)(function*(){try{const n=(0,h.b)(),i=s.extractInputFields(e.prompt_text||""),{error:d}=yield n.from("prompt_templates").insert([{...e,input_fields:i,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),created_by:"current_user",updated_by:"current_user"}]);if(d)throw d;yield s.loadTemplates()}catch(n){throw console.error("Error adding template:",n),n}})()}updateTemplate(e,s){var n=this;return(0,p.A)(function*(){try{const i=(0,h.b)(),d=n.extractInputFields(s.prompt_text||""),{error:c}=yield i.from("prompt_templates").update({...s,input_fields:d,updated_at:(new Date).toISOString(),updated_by:"current_user"}).eq("id",e);if(c)throw c;yield n.loadTemplates()}catch(i){throw console.error("Error updating template:",i),i}})()}deleteTemplate(e){var s=this;return(0,p.A)(function*(){try{const n=(0,h.b)(),{error:i}=yield n.from("prompt_templates").delete().eq("id",e);if(i)throw i;yield s.loadTemplates()}catch(n){throw console.error("Error deleting template:",n),n}})()}incrementUsageCount(e){var s=this;return(0,p.A)(function*(){try{const n=(0,h.b)(),{error:i}=yield n.rpc("increment_template_usage",{template_id:e});if(i)throw i;yield s.loadTemplates()}catch(n){console.error("Error incrementing usage count:",n)}})()}getTemplatesByFamilyType(e){return(0,p.A)(function*(){try{const s=(0,h.b)(),{data:n,error:i}=yield s.from("prompt_templates").select("*").eq("family_type",e).eq("status","active").order("display_order",{ascending:!0});if(i)throw i;return n||[]}catch(s){return console.error("Error getting templates by family type:",s),[]}})()}searchTemplates(e,s){return(0,p.A)(function*(){try{let i=(0,h.b)().from("prompt_templates").select("*").eq("status","active");s&&(i=i.eq("family_type",s)),e&&(i=i.or(`name.ilike.%${e}%,description.ilike.%${e}%,template_filters.ilike.%${e}%`));const{data:d,error:c}=yield i.order("display_order",{ascending:!0});if(c)throw c;return d||[]}catch(n){return console.error("Error searching templates:",n),[]}})()}extractInputFields(e){const s=[],n=new Set;let i;const d=f=>f.trim().toLowerCase().replace(/\s+/g," "),c=/\{\{([^}]+)\}\}/g;for(;null!==(i=c.exec(e));){const u=(i[1]||"").trim().split("|")[0].trim(),b=d(u);b&&!n.has(b)&&(n.add(b),s.push(u))}const y=/\[([^\]]+)\]/g;for(;null!==(i=y.exec(e));){const f=(i[1]||"").trim(),u=d(f);u&&!n.has(u)&&(n.add(u),s.push(f))}return s.filter(f=>{const u=(f||"").trim();return!(!u||u.length>80||u.includes("\n")||u.includes("|")||u.includes("<")||u.includes(">")||u.startsWith("http")||u.split(/\s+/).filter(Boolean).length>6||!/[a-zA-Z]/.test(u))})}getInputFields(e){return this.extractInputFields(e)}fillTemplate(e,s){const n=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let i=e;const d=s||{};for(const c of Object.keys(d)){const y=d[c]??`{{${c}}}`,I=Array.from(new Set([String(c),String(c).trim(),String(c).replace(/\s+/g,"_"),String(c).replace(/_/g," ")]));for(const f of I){const u=n(f),b=new RegExp(`\\{\\{\\s*${u}(?:[^}]*)\\}\\}`,"gi"),D=new RegExp(`\\[\\s*${u}\\s*\\]`,"gi");i=i.replace(b,y).replace(D,y)}}return i}getUniqueFamilyTypes(){var e=this;return(0,p.A)(function*(){try{const s=(0,h.b)(),{data:n,error:i}=yield s.from("prompt_templates").select("family_type").eq("status","active");if(i)throw i;return[...new Set((n||[]).map(c=>c.family_type))].map(c=>({label:e.formatFamilyLabel(c),value:c}))}catch(s){return console.error("Error getting unique family types:",s),[]}})()}getTemplateCategoriesByFamily(e){var s=this;return(0,p.A)(function*(){try{const n=(0,h.b)(),{data:i,error:d}=yield n.from("prompt_templates").select("template_category").eq("family_type",e).eq("status","active");if(d)throw d;return[...new Set((i||[]).map(y=>y.template_category))].map(y=>({label:s.formatCategoryLabel(y),value:y}))}catch(n){return console.error("Error getting template categories:",n),[]}})()}formatFamilyLabel(e){return{hedge_accounting:"Hedge Accounting",risk_management:"Risk Management",compliance:"Compliance",reporting:"Reporting",analysis:"Analysis",operations:"Operations"}[e]||this.formatCategoryLabel(e)}formatCategoryLabel(e){return e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}static{this.\u0275fac=function(s){return new(s||E)}}static{this.\u0275prov=w.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},6806:(T,C,o)=>{o.d(C,{G:()=>w});var p=o(467),A=o(7129),h=o(4438);let w=(()=>{class _{createSession(m,e,s,n,i){return(0,p.A)(function*(){const d={msg_uid:e,instruction_id:s,user_id:"test-user",session_type:"template",agent_status:"pending",agent_start_time:(new Date).toISOString(),template_category:n||"template",template_index:i||1,metadata:{prompt_text:m}};try{const c=(0,A.b)(),{error:y}=yield c.from("hawk_agent_sessions").upsert([d],{onConflict:"msg_uid"});if(y)throw y}catch(c){console.warn("createSession: proceeding without DB insert due to error:",c)}return{msg_uid:e,instruction_id:s,user_id:"test-user",session_type:"template",agent_status:"pending",template_category:n||"template",template_index:i||1,metadata:{prompt_text:m},created_at:(new Date).toISOString()}})()}getSessions(){return(0,p.A)(function*(){try{const m=(0,A.b)(),{data:e,error:s}=yield m.from("hawk_agent_sessions").select("*").order("created_at",{ascending:!1});if(s)throw s;return e||[]}catch(m){throw console.error("Error fetching sessions:",m),m}})()}updateSession(m,e){return(0,p.A)(function*(){try{const s=(0,A.b)(),{error:n}=yield s.from("hawk_agent_sessions").update(e).eq("msg_uid",m);if(n)throw n}catch(s){console.warn("updateSession: non-fatal error:",s)}})()}static{this.\u0275fac=function(e){return new(e||_)}}static{this.\u0275prov=h.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},8662:(T,C,o)=>{o.d(C,{P:()=>U});var p=o(7673),A=o(8359);class h extends A.yU{constructor(t,r){super()}schedule(t,r=0){return this}}const w={setInterval(l,t,...r){const{delegate:a}=w;return a?.setInterval?a.setInterval(l,t,...r):setInterval(l,t,...r)},clearInterval(l){const{delegate:t}=w;return(t?.clearInterval||clearInterval)(l)},delegate:void 0};var _=o(7908);const m={now:()=>(m.delegate||Date).now(),delegate:void 0};class e{constructor(t,r=e.now){this.schedulerActionCtor=t,this.now=r}schedule(t,r=0,a){return new this.schedulerActionCtor(this,t).schedule(a,r)}}e.now=m.now;const n=new class s extends e{constructor(t,r=e.now){super(t,r),this.actions=[],this._active=!1}flush(t){const{actions:r}=this;if(this._active)return void r.push(t);let a;this._active=!0;do{if(a=t.execute(t.state,t.delay))break}while(t=r.shift());if(this._active=!1,a){for(;t=r.shift();)t.unsubscribe();throw a}}}(class E extends h{constructor(t,r){super(t,r),this.scheduler=t,this.work=r,this.pending=!1}schedule(t,r=0){var a;if(this.closed)return this;this.state=t;const g=this.id,v=this.scheduler;return null!=g&&(this.id=this.recycleAsyncId(v,g,r)),this.pending=!0,this.delay=r,this.id=null!==(a=this.id)&&void 0!==a?a:this.requestAsyncId(v,this.id,r),this}requestAsyncId(t,r,a=0){return w.setInterval(t.flush.bind(t,this),a)}recycleAsyncId(t,r,a=0){if(null!=a&&this.delay===a&&!1===this.pending)return r;null!=r&&w.clearInterval(r)}execute(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(t,r);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,r){let g,a=!1;try{this.work(t)}catch(v){a=!0,g=v||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),g}unsubscribe(){if(!this.closed){const{id:t,scheduler:r}=this,{actions:a}=r;this.work=this.state=this.scheduler=null,this.pending=!1,(0,_.o)(a,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,super.unsubscribe()}}}),i=n;var d=o(8793),c=o(6697),y=o(9974),I=o(4360),f=o(5343),b=o(3703),D=o(1397),F=o(8750);function S(l,t){return t?r=>(0,d.x)(t.pipe((0,c.s)(1),function u(){return(0,y.N)((l,t)=>{l.subscribe((0,I._)(t,f.l))})}()),r.pipe(S(l))):(0,D.Z)((r,a)=>(0,F.Tg)(l(r,a)).pipe((0,c.s)(1),(0,b.u)(r)))}var N=o(1985),O=o(9470);function R(l,t=n){const r=function L(l=0,t,r=i){let a=-1;return null!=t&&((0,O.m)(t)?r=t:a=t),new N.c(g=>{let v=function M(l){return l instanceof Date&&!isNaN(l)}(l)?+l-r.now():l;v<0&&(v=0);let B=0;return r.schedule(function(){g.closed||(g.next(B++),0<=a?this.schedule(void 0,a):g.complete())},v)})}(l,t);return S(()=>r)}var x=o(6354),k=o(4438),P=o(1626);let U=(()=>{class l{constructor(r){this.http=r,this.mockCurrencyConfig=[{id:"1",currencyCode:"SGD",currencyName:"Singapore Dollar",isActive:!0,priority:1},{id:"2",currencyCode:"USD",currencyName:"US Dollar",isActive:!0,priority:2},{id:"3",currencyCode:"EUR",currencyName:"Euro",isActive:!0,priority:3},{id:"4",currencyCode:"GBP",currencyName:"British Pound",isActive:!0,priority:4},{id:"5",currencyCode:"JPY",currencyName:"Japanese Yen",isActive:!0,priority:5},{id:"6",currencyCode:"AUD",currencyName:"Australian Dollar",isActive:!0,priority:6},{id:"7",currencyCode:"HKD",currencyName:"Hong Kong Dollar",isActive:!0,priority:7},{id:"8",currencyCode:"CNY",currencyName:"Chinese Yuan",isActive:!0,priority:8},{id:"9",currencyCode:"INR",currencyName:"Indian Rupee",isActive:!0,priority:9},{id:"10",currencyCode:"KRW",currencyName:"South Korean Won",isActive:!0,priority:10},{id:"11",currencyCode:"TWD",currencyName:"Taiwan Dollar",isActive:!0,priority:11},{id:"12",currencyCode:"THB",currencyName:"Thai Baht",isActive:!0,priority:12},{id:"13",currencyCode:"MYR",currencyName:"Malaysian Ringgit",isActive:!0,priority:13},{id:"14",currencyCode:"CAD",currencyName:"Canadian Dollar",isActive:!0,priority:14},{id:"15",currencyCode:"CHF",currencyName:"Swiss Franc",isActive:!0,priority:15}]}getCurrencyCodes(){return(0,p.of)(this.mockCurrencyConfig).pipe(R(300),(0,x.T)(r=>r.filter(a=>a.isActive).sort((a,g)=>a.priority-g.priority).map(a=>a.currencyCode)))}getCurrencyConfigs(){return(0,p.of)(this.mockCurrencyConfig).pipe(R(300),(0,x.T)(r=>r.filter(a=>a.isActive)))}static{this.\u0275fac=function(a){return new(a||l)(k.KVO(P.Qq))}}static{this.\u0275prov=k.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()}}]);