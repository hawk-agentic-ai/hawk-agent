"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[984],{6984:(N,m,r)=>{r.r(m),r.d(m,{ThresholdConfigurationComponent:()=>I});var h=r(467),c=r(177),C=r(1141),b=r(2242),u=r(8833),f=r(1570),s=r(4341),y=r(9641),e=r(4438),M=r(4412),v=r(7129);let T=(()=>{class a{constructor(){this.thresholdSubject=new M.t([]),this.thresholds$=this.thresholdSubject.asObservable(),this.supabase=(0,v.b)(),this.fetchThresholds(),this.subscribeRealtime()}fetchThresholds(){var i=this;return(0,h.A)(function*(){const{data:l,error:n}=yield i.supabase.from("threshold_configuration").select("*");!n&&l&&i.thresholdSubject.next(l)})()}subscribeRealtime(){this.channel=this.supabase.channel("threshold_configuration_changes").on("postgres_changes",{event:"*",schema:"public",table:"threshold_configuration"},i=>{this.fetchThresholds()}).subscribe()}addThreshold(i){var l=this;return(0,h.A)(function*(){yield l.supabase.from("threshold_configuration").insert([i])})()}updateThreshold(i,l){var n=this;return(0,h.A)(function*(){yield n.supabase.from("threshold_configuration").update(l).eq("threshold_id",i)})()}deleteThreshold(i){var l=this;return(0,h.A)(function*(){yield l.supabase.from("threshold_configuration").delete().eq("threshold_id",i)})()}static{this.\u0275fac=function(l){return new(l||a)}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var w=r(5779);const F=()=>({width:"100vw",height:"95vh","max-width":"100vw","max-height":"95vh","border-top-left-radius":"16px","border-top-right-radius":"16px"}),g=()=>({width:"100%"}),j=()=>({label:"Yes",value:"Y"}),R=()=>({label:"No",value:"N"}),_=(a,p)=>[a,p],k=()=>({label:"Active",value:"Y"}),D=()=>({label:"Inactive",value:"N"});function E(a,p){if(1&a){const i=e.RV6();e.j41(0,"div",46)(1,"button",47),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.showSheet=!1)}),e.EFF(2,"Cancel"),e.k0s(),e.j41(3,"button",5),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.confirmSave())}),e.EFF(4),e.k0s()()}if(2&a){const i=e.XpG();e.R7$(4),e.JRh("edit"===i.mode?"Update Threshold":"Save Threshold")}}let I=(()=>{class a{constructor(i,l){this.ngZone=i,this.thresholdService=l,this.defaultColDef={resizable:!0,sortable:!0,filter:"agSetColumnFilter",minWidth:100},this.thresholds=[],this.search="",this.showSheet=!1,this.mode="add",this.pendingDeleteId=null,this.showConfirmDelete=!1,this.form={breach_tolerance_minutes:0,warning_level:0,effective_date:"",expiry_date:"",critical_level:0,created_date:"",maximum_limit:0,modified_date:"",automated_action_flag:"",notification_emails:"",active_flag:"",created_by:"",modified_by:"",escalation_level_3:"",threshold_type:"",currency_code:"",entity_type:"",unit_of_measure:"",escalation_level_1:"",escalation_level_2:"",threshold_id:""},this.columnDefs=[{field:"threshold_id",headerName:"Threshold ID",minWidth:160,sortable:!0},{field:"threshold_type",headerName:"Type",width:140,sortable:!0},{field:"currency_code",headerName:"Currency",width:100,sortable:!0},{field:"entity_type",headerName:"Entity Type",width:140,sortable:!0},{field:"unit_of_measure",headerName:"Unit",width:120,sortable:!0},{field:"maximum_limit",headerName:"Max Limit",width:120,sortable:!0},{field:"warning_level",headerName:"Warning",width:100,sortable:!0},{field:"critical_level",headerName:"Critical",width:100,sortable:!0},{field:"breach_tolerance_minutes",headerName:"Tolerance (min)",width:120,sortable:!0},{field:"automated_action_flag",headerName:"Automated",width:100,cellRenderer:n=>{const o="Y"===n.value?"Yes":"No",t="Yes"===o?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",d=document.createElement("span");return d.className=`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t}`,d.textContent=o,d}},{field:"active_flag",headerName:"Status",width:100,cellRenderer:n=>{const o="Y"===n.value?"Active":"Inactive",t="Active"===o?"bg-green-100 text-green-800":"bg-red-100 text-red-800",d=document.createElement("span");return d.className=`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t}`,d.textContent=o,d}},{field:"effective_date",headerName:"Effective Date",width:140,sortable:!0},{field:"expiry_date",headerName:"Expiry Date",width:140,sortable:!0},{field:"created_date",headerName:"Created Date",width:140,sortable:!0},{field:"modified_date",headerName:"Modified Date",width:140,sortable:!0},{field:"created_by",headerName:"Created By",width:120,sortable:!0},{field:"modified_by",headerName:"Modified By",width:120,sortable:!0},{field:"escalation_level_1",headerName:"Escalation 1",width:120,sortable:!0},{field:"escalation_level_2",headerName:"Escalation 2",width:120,sortable:!0},{field:"escalation_level_3",headerName:"Escalation 3",width:120,sortable:!0},{field:"notification_emails",headerName:"Notification Emails",width:160,sortable:!0},{headerName:"Actions",width:120,pinned:"right",cellRenderer:n=>{const o=document.createElement("div");o.className="flex items-center justify-center space-x-2";const t=document.createElement("button");t.className="text-gray-500 hover:text-blue-600 p-1",t.title="Edit Threshold",t.innerHTML='<i class="pi pi-pencil text-sm"></i>',t.addEventListener("click",()=>n.context.componentParent.editRow(n.data));const d=document.createElement("button");return d.className="text-gray-500 hover:text-red-600 p-1",d.title="Delete Threshold",d.innerHTML='<i class="pi pi-trash text-sm"></i>',d.addEventListener("click",()=>n.context.componentParent.deleteRow(n.data)),o.appendChild(t),o.appendChild(d),o}}],this.gridOptions={pagination:!0,paginationPageSize:20,animateRows:!0,context:{componentParent:this}}}ngOnInit(){this.thresholdSub=this.thresholdService.thresholds$.subscribe(i=>{this.thresholds=i,setTimeout(()=>this.gridApi?.sizeColumnsToFit(),0)})}ngOnDestroy(){this.thresholdSub&&this.thresholdSub.unsubscribe()}onGridReady(i){this.gridApi=i.api,i.api.sizeColumnsToFit()}onSearchChange(i){this.search=i,this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>this.applyFilters(),300)}applyFilters(){let i=this.thresholds;if(this.search.trim()){const l=this.search.trim().toLowerCase();i=i.filter(n=>n.threshold_id?.toLowerCase().includes(l)||n.threshold_type?.toLowerCase().includes(l)||n.currency_code?.toLowerCase().includes(l)||n.entity_type?.toLowerCase().includes(l))}this.gridApi?.setRowData(i),setTimeout(()=>this.gridApi?.sizeColumnsToFit(),0)}openAdd(){this.mode="add",this.form={},this.ngZone.run(()=>this.showSheet=!0)}editRow(i){var l=this;return(0,h.A)(function*(){l.mode="edit",l.form={...i},l.ngZone.run(()=>l.showSheet=!0)})()}deleteRow(i){this.pendingDeleteId=i.threshold_id,this.showConfirmDelete=!0,this.showSheet=!1}confirmDelete(){var i=this;return(0,h.A)(function*(){i.pendingDeleteId&&(yield i.thresholdService.deleteThreshold(i.pendingDeleteId),i.showConfirmDelete=!1,i.pendingDeleteId=null)})()}confirmSave(){var i=this;return(0,h.A)(function*(){"edit"===i.mode&&i.form.threshold_id?yield i.thresholdService.updateThreshold(i.form.threshold_id,i.form):yield i.thresholdService.addThreshold(i.form),i.showSheet=!1,i.mode="add",i.form={}})()}static{this.\u0275fac=function(l){return new(l||a)(e.rXU(e.SKi),e.rXU(T))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-config-threshold-configuration"]],standalone:!0,features:[e.aNF],decls:127,vars:51,consts:[[1,"p-6"],[1,"mb-6"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"btn","btn-primary",3,"click"],[1,"pi","pi-plus"],[1,"flex","items-center","gap-4","mb-4"],[1,"flex-1","flex","items-center","gap-2"],[1,"filter-label"],["type","text","placeholder","Search thresholds...",1,"filter-input","flex-1","max-w-xs",3,"ngModelChange","ngModel"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"ag-theme-alpine","w-full",2,"height","600px",3,"gridReady","columnDefs","rowData","defaultColDef","gridOptions"],["styleClass","entity-dialog entity-dialog-full",3,"visibleChange","header","visible","modal","closable"],[1,"space-y-6","p-2"],[1,"rounded-lg","border","border-gray-200","p-4","bg-white"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","md:col-span-3","flex","items-center"],[1,"text-sm","font-semibold","text-gray-700"],[1,"col-span-12","md:col-span-9"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"field"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","name","threshold_id",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","threshold_type",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","currency_code",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","entity_type",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","unit_of_measure",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","number","name","maximum_limit",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","number","name","warning_level",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","number","name","critical_level",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","number","name","breach_tolerance_minutes",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["name","automated_action_flag","placeholder","Select","styleClass","filter-input w-full",3,"ngModelChange","options","ngModel"],["name","active_flag","placeholder","Select status","styleClass","filter-input w-full",3,"ngModelChange","options","ngModel"],["type","text","name","escalation_level_1",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","escalation_level_2",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","escalation_level_3",1,"filter-input","w-full",3,"ngModelChange","ngModel"],[1,"field","col-span-2"],["rows","2","name","notification_emails",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","date","name","effective_date",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","date","name","expiry_date",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","datetime-local","name","created_date",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","datetime-local","name","modified_date",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","created_by",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["type","text","name","modified_by",1,"filter-input","w-full",3,"ngModelChange","ngModel"],["pTemplate","footer"],[1,"flex","justify-end","space-x-3","pt-4","border-t","border-gray-200"],[1,"btn","btn-secondary",3,"click"]],template:function(l,n){1&l&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h2",3),e.EFF(5,"Threshold Configuration"),e.k0s(),e.j41(6,"p",4),e.EFF(7,"Manage and configure threshold settings for risk monitoring"),e.k0s()(),e.j41(8,"button",5),e.bIt("click",function(){return n.openAdd()}),e.nrm(9,"i",6),e.j41(10,"span"),e.EFF(11,"Add Threshold"),e.k0s()()()(),e.j41(12,"div",7)(13,"div",8)(14,"label",9),e.EFF(15,"Search:"),e.k0s(),e.j41(16,"input",10),e.mxI("ngModelChange",function(t){return e.DH7(n.search,t)||(n.search=t),t}),e.bIt("ngModelChange",function(t){return n.onSearchChange(t)}),e.k0s()()(),e.j41(17,"div",11)(18,"ag-grid-angular",12),e.bIt("gridReady",function(t){return n.onGridReady(t)}),e.k0s()(),e.j41(19,"p-dialog",13),e.mxI("visibleChange",function(t){return e.DH7(n.showSheet,t)||(n.showSheet=t),t}),e.j41(20,"form",14)(21,"div",15)(22,"div",16)(23,"div",17)(24,"div",18),e.EFF(25,"Basic Info"),e.k0s()(),e.j41(26,"div",19)(27,"div",20)(28,"div",21)(29,"label",22),e.EFF(30,"Threshold ID"),e.k0s(),e.j41(31,"input",23),e.mxI("ngModelChange",function(t){return e.DH7(n.form.threshold_id,t)||(n.form.threshold_id=t),t}),e.k0s()(),e.j41(32,"div",21)(33,"label",22),e.EFF(34,"Threshold Type"),e.k0s(),e.j41(35,"input",24),e.mxI("ngModelChange",function(t){return e.DH7(n.form.threshold_type,t)||(n.form.threshold_type=t),t}),e.k0s()(),e.j41(36,"div",21)(37,"label",22),e.EFF(38,"Currency Code"),e.k0s(),e.j41(39,"input",25),e.mxI("ngModelChange",function(t){return e.DH7(n.form.currency_code,t)||(n.form.currency_code=t),t}),e.k0s()(),e.j41(40,"div",21)(41,"label",22),e.EFF(42,"Entity Type"),e.k0s(),e.j41(43,"input",26),e.mxI("ngModelChange",function(t){return e.DH7(n.form.entity_type,t)||(n.form.entity_type=t),t}),e.k0s()(),e.j41(44,"div",21)(45,"label",22),e.EFF(46,"Unit of Measure"),e.k0s(),e.j41(47,"input",27),e.mxI("ngModelChange",function(t){return e.DH7(n.form.unit_of_measure,t)||(n.form.unit_of_measure=t),t}),e.k0s()(),e.j41(48,"div",21)(49,"label",22),e.EFF(50,"Maximum Limit"),e.k0s(),e.j41(51,"input",28),e.mxI("ngModelChange",function(t){return e.DH7(n.form.maximum_limit,t)||(n.form.maximum_limit=t),t}),e.k0s()(),e.j41(52,"div",21)(53,"label",22),e.EFF(54,"Warning Level"),e.k0s(),e.j41(55,"input",29),e.mxI("ngModelChange",function(t){return e.DH7(n.form.warning_level,t)||(n.form.warning_level=t),t}),e.k0s()(),e.j41(56,"div",21)(57,"label",22),e.EFF(58,"Critical Level"),e.k0s(),e.j41(59,"input",30),e.mxI("ngModelChange",function(t){return e.DH7(n.form.critical_level,t)||(n.form.critical_level=t),t}),e.k0s()(),e.j41(60,"div",21)(61,"label",22),e.EFF(62,"Tolerance (min)"),e.k0s(),e.j41(63,"input",31),e.mxI("ngModelChange",function(t){return e.DH7(n.form.breach_tolerance_minutes,t)||(n.form.breach_tolerance_minutes=t),t}),e.k0s()(),e.j41(64,"div",21)(65,"label",22),e.EFF(66,"Automated Action"),e.k0s(),e.j41(67,"p-dropdown",32),e.mxI("ngModelChange",function(t){return e.DH7(n.form.automated_action_flag,t)||(n.form.automated_action_flag=t),t}),e.k0s()(),e.j41(68,"div",21)(69,"label",22),e.EFF(70,"Status"),e.k0s(),e.j41(71,"p-dropdown",33),e.mxI("ngModelChange",function(t){return e.DH7(n.form.active_flag,t)||(n.form.active_flag=t),t}),e.k0s()()()()()(),e.j41(72,"div",15)(73,"div",16)(74,"div",17)(75,"div",18),e.EFF(76,"Escalation & Notification"),e.k0s()(),e.j41(77,"div",19)(78,"div",20)(79,"div",21)(80,"label",22),e.EFF(81,"Escalation Level 1"),e.k0s(),e.j41(82,"input",34),e.mxI("ngModelChange",function(t){return e.DH7(n.form.escalation_level_1,t)||(n.form.escalation_level_1=t),t}),e.k0s()(),e.j41(83,"div",21)(84,"label",22),e.EFF(85,"Escalation Level 2"),e.k0s(),e.j41(86,"input",35),e.mxI("ngModelChange",function(t){return e.DH7(n.form.escalation_level_2,t)||(n.form.escalation_level_2=t),t}),e.k0s()(),e.j41(87,"div",21)(88,"label",22),e.EFF(89,"Escalation Level 3"),e.k0s(),e.j41(90,"input",36),e.mxI("ngModelChange",function(t){return e.DH7(n.form.escalation_level_3,t)||(n.form.escalation_level_3=t),t}),e.k0s()(),e.j41(91,"div",37)(92,"label",22),e.EFF(93,"Notification Emails"),e.k0s(),e.j41(94,"textarea",38),e.mxI("ngModelChange",function(t){return e.DH7(n.form.notification_emails,t)||(n.form.notification_emails=t),t}),e.k0s()()()()()(),e.j41(95,"div",15)(96,"div",16)(97,"div",17)(98,"div",18),e.EFF(99,"Dates & Audit"),e.k0s()(),e.j41(100,"div",19)(101,"div",20)(102,"div",21)(103,"label",22),e.EFF(104,"Effective Date"),e.k0s(),e.j41(105,"input",39),e.mxI("ngModelChange",function(t){return e.DH7(n.form.effective_date,t)||(n.form.effective_date=t),t}),e.k0s()(),e.j41(106,"div",21)(107,"label",22),e.EFF(108,"Expiry Date"),e.k0s(),e.j41(109,"input",40),e.mxI("ngModelChange",function(t){return e.DH7(n.form.expiry_date,t)||(n.form.expiry_date=t),t}),e.k0s()(),e.j41(110,"div",21)(111,"label",22),e.EFF(112,"Created Date"),e.k0s(),e.j41(113,"input",41),e.mxI("ngModelChange",function(t){return e.DH7(n.form.created_date,t)||(n.form.created_date=t),t}),e.k0s()(),e.j41(114,"div",21)(115,"label",22),e.EFF(116,"Modified Date"),e.k0s(),e.j41(117,"input",42),e.mxI("ngModelChange",function(t){return e.DH7(n.form.modified_date,t)||(n.form.modified_date=t),t}),e.k0s()(),e.j41(118,"div",21)(119,"label",22),e.EFF(120,"Created By"),e.k0s(),e.j41(121,"input",43),e.mxI("ngModelChange",function(t){return e.DH7(n.form.created_by,t)||(n.form.created_by=t),t}),e.k0s()(),e.j41(122,"div",21)(123,"label",22),e.EFF(124,"Modified By"),e.k0s(),e.j41(125,"input",44),e.mxI("ngModelChange",function(t){return e.DH7(n.form.modified_by,t)||(n.form.modified_by=t),t}),e.k0s()()()()()()(),e.DNE(126,E,5,1,"ng-template",45),e.k0s()()),2&l&&(e.R7$(16),e.R50("ngModel",n.search),e.R7$(2),e.Y8G("columnDefs",n.columnDefs)("rowData",n.thresholds)("defaultColDef",n.defaultColDef)("gridOptions",n.gridOptions),e.R7$(),e.Aen(e.lJ4(38,F)),e.FS9("header","edit"===n.mode?"Edit Threshold":"Add Threshold"),e.R50("visible",n.showSheet),e.Y8G("modal",!0)("closable",!0),e.R7$(12),e.R50("ngModel",n.form.threshold_id),e.R7$(4),e.R50("ngModel",n.form.threshold_type),e.R7$(4),e.R50("ngModel",n.form.currency_code),e.R7$(4),e.R50("ngModel",n.form.entity_type),e.R7$(4),e.R50("ngModel",n.form.unit_of_measure),e.R7$(4),e.R50("ngModel",n.form.maximum_limit),e.R7$(4),e.R50("ngModel",n.form.warning_level),e.R7$(4),e.R50("ngModel",n.form.critical_level),e.R7$(4),e.R50("ngModel",n.form.breach_tolerance_minutes),e.R7$(4),e.Aen(e.lJ4(39,g)),e.Y8G("options",e.l_i(42,_,e.lJ4(40,j),e.lJ4(41,R))),e.R50("ngModel",n.form.automated_action_flag),e.R7$(4),e.Aen(e.lJ4(45,g)),e.Y8G("options",e.l_i(48,_,e.lJ4(46,k),e.lJ4(47,D))),e.R50("ngModel",n.form.active_flag),e.R7$(11),e.R50("ngModel",n.form.escalation_level_1),e.R7$(4),e.R50("ngModel",n.form.escalation_level_2),e.R7$(4),e.R50("ngModel",n.form.escalation_level_3),e.R7$(4),e.R50("ngModel",n.form.notification_emails),e.R7$(11),e.R50("ngModel",n.form.effective_date),e.R7$(4),e.R50("ngModel",n.form.expiry_date),e.R7$(4),e.R50("ngModel",n.form.created_date),e.R7$(4),e.R50("ngModel",n.form.modified_date),e.R7$(4),e.R50("ngModel",n.form.created_by),e.R7$(4),e.R50("ngModel",n.form.modified_by))},dependencies:[c.MD,C.tm,w.Ei,y.xs,b.u,u.kr,u.ms,f.P,f.l,s.YN,s.qT,s.me,s.Q0,s.BC,s.cb,s.vS,s.cV],encapsulation:2})}}return a})()}}]);