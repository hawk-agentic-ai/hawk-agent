"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[241],{2241:(C,p,r)=>{r.r(p),r.d(p,{MurexBookingComponent:()=>j});var g=r(467),u=r(177),s=r(4341),F=r(9641),h=r(1570),m=r(1141),e=r(4438),c=r(7129);let v=(()=>{class a{constructor(){this.table="deal_bookings"}list(t){var o=this;return(0,g.A)(function*(){try{let n=(0,c.b)().from(o.table).select("*").order("created_date",{ascending:!1}).limit(1e3);if(t?.search?.trim()){const l=t.search.trim();n=n.or(`deal_booking_id.ilike.%${l}%,internal_reference.ilike.%${l}%,external_reference.ilike.%${l}%,booking_reference.ilike.%${l}%,counterparty.ilike.%${l}%`)}t?.dealType&&(n=n.eq("deal_type",t.dealType)),t?.portfolio&&(n=n.eq("portfolio",t.portfolio)),t?.tradeDate&&(n=n.eq("trade_date",t.tradeDate)),t?.dealStatus&&(n=n.eq("deal_status",t.dealStatus));const{data:d,error:f}=yield n;if(f)throw f;return d||[]}catch(i){return console.error("Failed to load deal_bookings",i),[]}})()}subscribeRealtime(t){try{const o=(0,c.b)();this.channel=o.channel("deal_bookings_changes").on("postgres_changes",{event:"*",schema:"public",table:this.table},()=>t()).subscribe()}catch(o){console.warn("Realtime subscription unavailable for deal_bookings",o)}}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var k=r(5779);const _=()=>({width:"100vw",height:"95vh","max-width":"100vw","max-height":"95vh","border-top-left-radius":"16px","border-top-right-radius":"16px"});function R(a,b){if(1&a&&(e.j41(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21)(4,"div",22),e.EFF(5,"Identifiers"),e.k0s()(),e.j41(6,"div",23)(7,"div")(8,"div",24),e.EFF(9,"Deal Booking ID"),e.k0s(),e.j41(10,"div",25),e.EFF(11),e.k0s()(),e.j41(12,"div")(13,"div",24),e.EFF(14,"Internal Ref"),e.k0s(),e.j41(15,"div",25),e.EFF(16),e.k0s()(),e.j41(17,"div")(18,"div",24),e.EFF(19,"External Ref"),e.k0s(),e.j41(20,"div",25),e.EFF(21),e.k0s()(),e.j41(22,"div")(23,"div",24),e.EFF(24,"Booking Ref"),e.k0s(),e.j41(25,"div",25),e.EFF(26),e.k0s()()()()(),e.j41(27,"div",19)(28,"div",20)(29,"div",21)(30,"div",22),e.EFF(31,"Core Details"),e.k0s()(),e.j41(32,"div",23)(33,"div")(34,"div",24),e.EFF(35,"Deal Type"),e.k0s(),e.j41(36,"div",25),e.EFF(37),e.k0s()(),e.j41(38,"div")(39,"div",24),e.EFF(40,"Product Type"),e.k0s(),e.j41(41,"div",25),e.EFF(42),e.k0s()(),e.j41(43,"div")(44,"div",24),e.EFF(45,"Portfolio"),e.k0s(),e.j41(46,"div",25),e.EFF(47),e.k0s()(),e.j41(48,"div")(49,"div",24),e.EFF(50,"Counterparty"),e.k0s(),e.j41(51,"div",25),e.EFF(52),e.k0s()(),e.j41(53,"div")(54,"div",24),e.EFF(55,"System"),e.k0s(),e.j41(56,"div",25),e.EFF(57),e.k0s()(),e.j41(58,"div")(59,"div",24),e.EFF(60,"Deal Status"),e.k0s(),e.j41(61,"div",25),e.EFF(62),e.k0s()(),e.j41(63,"div")(64,"div",24),e.EFF(65,"Trade Date"),e.k0s(),e.j41(66,"div",25),e.EFF(67),e.k0s()(),e.j41(68,"div")(69,"div",24),e.EFF(70,"Value Date"),e.k0s(),e.j41(71,"div",25),e.EFF(72),e.k0s()(),e.j41(73,"div")(74,"div",24),e.EFF(75,"Maturity Date"),e.k0s(),e.j41(76,"div",25),e.EFF(77),e.k0s()()()()(),e.j41(78,"div",19)(79,"div",20)(80,"div",21)(81,"div",22),e.EFF(82,"Amounts & Rates"),e.k0s()(),e.j41(83,"div",23)(84,"div")(85,"div",24),e.EFF(86,"Sell Amount"),e.k0s(),e.j41(87,"div",25),e.EFF(88),e.k0s()(),e.j41(89,"div")(90,"div",24),e.EFF(91,"Sell Currency"),e.k0s(),e.j41(92,"div",25),e.EFF(93),e.k0s()(),e.j41(94,"div")(95,"div",24),e.EFF(96,"Buy Amount"),e.k0s(),e.j41(97,"div",25),e.EFF(98),e.k0s()(),e.j41(99,"div")(100,"div",24),e.EFF(101,"Buy Currency"),e.k0s(),e.j41(102,"div",25),e.EFF(103),e.k0s()(),e.j41(104,"div")(105,"div",24),e.EFF(106,"FX Rate"),e.k0s(),e.j41(107,"div",25),e.EFF(108),e.k0s()(),e.j41(109,"div")(110,"div",24),e.EFF(111,"Swap Points"),e.k0s(),e.j41(112,"div",25),e.EFF(113),e.k0s()()()()(),e.j41(114,"div",19)(115,"div",20)(116,"div",21)(117,"div",22),e.EFF(118,"Notes / Purpose"),e.k0s()(),e.j41(119,"div",23)(120,"div",26)(121,"div",24),e.EFF(122,"Purpose"),e.k0s(),e.j41(123,"div",25),e.EFF(124),e.k0s()(),e.j41(125,"div",26)(126,"div",24),e.EFF(127,"Proxy Purpose"),e.k0s(),e.j41(128,"div",25),e.EFF(129),e.k0s()(),e.j41(130,"div",26)(131,"div",24),e.EFF(132,"Comment"),e.k0s(),e.j41(133,"div",25),e.EFF(134),e.k0s()()()()(),e.j41(135,"div",19)(136,"div",20)(137,"div",21)(138,"div",22),e.EFF(139,"JSON Structures"),e.k0s()(),e.j41(140,"div",27)(141,"div")(142,"div",24),e.EFF(143,"Near Leg"),e.k0s(),e.j41(144,"pre",28),e.EFF(145),e.nI1(146,"json"),e.k0s()(),e.j41(147,"div")(148,"div",24),e.EFF(149,"Far Leg"),e.k0s(),e.j41(150,"pre",28),e.EFF(151),e.nI1(152,"json"),e.k0s()(),e.j41(153,"div")(154,"div",24),e.EFF(155,"NDF"),e.k0s(),e.j41(156,"pre",28),e.EFF(157),e.nI1(158,"json"),e.k0s()(),e.j41(159,"div")(160,"div",24),e.EFF(161,"Spot Details"),e.k0s(),e.j41(162,"pre",28),e.EFF(163),e.nI1(164,"json"),e.k0s()(),e.j41(165,"div")(166,"div",24),e.EFF(167,"Embedded Spot"),e.k0s(),e.j41(168,"pre",28),e.EFF(169),e.nI1(170,"json"),e.k0s()(),e.j41(171,"div")(172,"div",24),e.EFF(173,"Currency Pair"),e.k0s(),e.j41(174,"pre",28),e.EFF(175),e.nI1(176,"json"),e.k0s()(),e.j41(177,"div")(178,"div",24),e.EFF(179,"Currency Proxy"),e.k0s(),e.j41(180,"pre",28),e.EFF(181),e.nI1(182,"json"),e.k0s()()()()()()),2&a){const t=e.XpG();e.R7$(11),e.JRh(t.selected.deal_booking_id),e.R7$(5),e.JRh(t.selected.internal_reference),e.R7$(5),e.JRh(t.selected.external_reference),e.R7$(5),e.JRh(t.selected.booking_reference),e.R7$(11),e.JRh(t.selected.deal_type),e.R7$(5),e.JRh(t.selected.product_type),e.R7$(5),e.JRh(t.selected.portfolio),e.R7$(5),e.JRh(t.selected.counterparty),e.R7$(5),e.JRh(t.selected.system),e.R7$(5),e.JRh(t.selected.deal_status),e.R7$(5),e.JRh(t.selected.trade_date),e.R7$(5),e.JRh(t.selected.value_date),e.R7$(5),e.JRh(t.selected.maturity_date),e.R7$(11),e.JRh(t.selected.sell_amount),e.R7$(5),e.JRh(t.selected.sell_currency),e.R7$(5),e.JRh(t.selected.buy_amount),e.R7$(5),e.JRh(t.selected.buy_currency),e.R7$(5),e.JRh(t.selected.fx_rate),e.R7$(5),e.JRh(t.selected.swap_points),e.R7$(11),e.JRh(t.selected.purpose),e.R7$(5),e.JRh(t.selected.proxy_purpose),e.R7$(5),e.JRh(t.selected.comment1),e.R7$(11),e.JRh(e.bMT(146,29,t.selected.near_leg_structure)),e.R7$(6),e.JRh(e.bMT(152,31,t.selected.far_leg_structure)),e.R7$(6),e.JRh(e.bMT(158,33,t.selected.ndf_structure)),e.R7$(6),e.JRh(e.bMT(164,35,t.selected.spot_details)),e.R7$(6),e.JRh(e.bMT(170,37,t.selected.embedded_spot_details)),e.R7$(6),e.JRh(e.bMT(176,39,t.selected.currency_pair)),e.R7$(6),e.JRh(e.bMT(182,41,t.selected.currency_proxy))}}function y(a,b){if(1&a){const t=e.RV6();e.j41(0,"div",29)(1,"button",30),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showDialog=!1)}),e.EFF(2,"Close"),e.k0s()()}}let j=(()=>{class a{constructor(t){this.svc=t,this.rows=[],this.search="",this.dealType=null,this.portfolio=null,this.tradeDate=null,this.dealStatus=null,this.showDialog=!1,this.selected=null,this.columnDefs=[{field:"booking_reference",headerName:"Booking Ref",width:160},{field:"internal_reference",headerName:"Internal Ref",width:140},{field:"external_reference",headerName:"External Ref",width:140},{field:"deal_booking_id",headerName:"Deal ID",width:160},{field:"deal_type",headerName:"Deal Type",width:140},{field:"product_type",headerName:"Product Type",width:140},{field:"portfolio",headerName:"Portfolio",width:140},{field:"counterparty",headerName:"Counterparty",width:160},{field:"system",headerName:"System",width:120},{field:"deal_status",headerName:"Status",width:120},{field:"trade_date",headerName:"Trade Date",width:130},{field:"value_date",headerName:"Value Date",width:130},{field:"maturity_date",headerName:"Maturity",width:130},{field:"sell_amount",headerName:"Sell Amt",width:120,type:"numericColumn"},{field:"sell_currency",headerName:"Sell CCY",width:110},{field:"buy_amount",headerName:"Buy Amt",width:120,type:"numericColumn"},{field:"buy_currency",headerName:"Buy CCY",width:110},{field:"fx_rate",headerName:"FX Rate",width:110},{field:"swap_points",headerName:"Swap Pts",width:110},{field:"transfer_type",headerName:"Transfer Type",width:130},{field:"currency_pair",headerName:"Currency Pair",width:180,cellRenderer:o=>{const i=document.createElement("span");try{const n=o.value;if(!n)return i.textContent="",i;const d=n.pair||(n.base&&n.term?`${n.base}/${n.term}`:JSON.stringify(n));i.textContent=d}catch{i.textContent=String(o.value??"")}return i}},{field:"purpose",headerName:"Purpose",width:140},{field:"comment1",headerName:"Comment",flex:1},{headerName:"Actions",width:100,pinned:"right",cellRenderer:o=>{const i=document.createElement("button");return i.className="text-gray-500 hover:text-blue-600 p-1",i.title="View Details",i.innerHTML='<i class="pi pi-eye"></i>',i.addEventListener("click",()=>o.context.componentParent.viewRow(o.data)),i}}],this.defaultColDef={resizable:!0,sortable:!0,filter:"agSetColumnFilter",minWidth:100},this.gridOptions={pagination:!0,paginationPageSize:25,animateRows:!0,context:{componentParent:this}}}ngOnInit(){this.load(),this.svc.subscribeRealtime(()=>this.load())}load(){var t=this;return(0,g.A)(function*(){t.rows=yield t.svc.list({search:t.search||void 0,dealType:t.dealType||void 0,portfolio:t.portfolio||void 0,tradeDate:t.tradeDate||void 0,dealStatus:t.dealStatus||void 0}),setTimeout(()=>t.gridApi?.sizeColumnsToFit(),50)})()}onGridReady(t){this.gridApi=t.api,t.api.sizeColumnsToFit()}viewRow(t){this.selected=t,this.showDialog=!0}onResize(){setTimeout(()=>this.gridApi?.sizeColumnsToFit(),100)}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(v))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-operations-murex-booking"]],hostBindings:function(o,i){1&o&&e.bIt("resize",function(){return i.onResize()},!1,e.tSv)},standalone:!0,features:[e.aNF],decls:33,vars:15,consts:[[1,"p-6","h-full","flex","flex-col"],[1,"mb-6"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"filter-bar"],[1,"filter-row","w-full"],[1,"flex","items-center","space-x-2"],[1,"filter-label"],["placeholder","deal_booking_id, references, counterparty",1,"filter-input","w-72",3,"ngModelChange","ngModel"],["placeholder","e.g., FX Swap",1,"filter-input","w-48",3,"ngModelChange","ngModel"],["placeholder","Code",1,"filter-input","w-48",3,"ngModelChange","ngModel"],["type","date",1,"filter-input",3,"ngModelChange","ngModel"],["placeholder","e.g., Booked",1,"filter-input","w-40",3,"ngModelChange","ngModel"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200",2,"height","600px"],[1,"ag-theme-alpine","w-full",2,"width","100%","height","100%",3,"gridReady","columnDefs","rowData","defaultColDef","gridOptions"],["header","Deal Booking Details","styleClass","entity-dialog entity-dialog-full",3,"visibleChange","visible","modal"],["class","space-y-4 p-2",4,"ngIf"],["pTemplate","footer"],[1,"space-y-4","p-2"],[1,"rounded-lg","border","border-gray-200","p-4","bg-white"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","md:col-span-3"],[1,"text-sm","font-semibold","text-gray-700"],[1,"col-span-12","md:col-span-9","grid","grid-cols-1","md:grid-cols-2","gap-3","text-sm"],[1,"text-gray-500"],[1,"font-medium"],[1,"md:col-span-2"],[1,"col-span-12","md:col-span-9","grid","grid-cols-1","gap-3","text-sm"],[1,"bg-gray-50","border","rounded","p-3","whitespace-pre-wrap"],[1,"flex","justify-end","space-x-3","pt-4","border-t","border-gray-200"],[1,"btn","btn-secondary",3,"click"]],template:function(o,i){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3,"Murex Booking"),e.k0s(),e.j41(4,"p",3),e.EFF(5,"Live from deal_bookings (Supabase)"),e.k0s()(),e.j41(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),e.EFF(10,"Search:"),e.k0s(),e.j41(11,"input",8),e.mxI("ngModelChange",function(d){return e.DH7(i.search,d)||(i.search=d),d}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(12,"div",6)(13,"label",7),e.EFF(14,"Deal Type:"),e.k0s(),e.j41(15,"input",9),e.mxI("ngModelChange",function(d){return e.DH7(i.dealType,d)||(i.dealType=d),d}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(16,"div",6)(17,"label",7),e.EFF(18,"Portfolio:"),e.k0s(),e.j41(19,"input",10),e.mxI("ngModelChange",function(d){return e.DH7(i.portfolio,d)||(i.portfolio=d),d}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(20,"div",6)(21,"label",7),e.EFF(22,"Trade Date:"),e.k0s(),e.j41(23,"input",11),e.mxI("ngModelChange",function(d){return e.DH7(i.tradeDate,d)||(i.tradeDate=d),d}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(24,"div",6)(25,"label",7),e.EFF(26,"Status:"),e.k0s(),e.j41(27,"input",12),e.mxI("ngModelChange",function(d){return e.DH7(i.dealStatus,d)||(i.dealStatus=d),d}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()()()(),e.j41(28,"div",13)(29,"ag-grid-angular",14),e.bIt("gridReady",function(d){return i.onGridReady(d)}),e.k0s()(),e.j41(30,"p-dialog",15),e.mxI("visibleChange",function(d){return e.DH7(i.showDialog,d)||(i.showDialog=d),d}),e.DNE(31,R,183,43,"div",16)(32,y,3,0,"ng-template",17),e.k0s()()),2&o&&(e.R7$(11),e.R50("ngModel",i.search),e.R7$(4),e.R50("ngModel",i.dealType),e.R7$(4),e.R50("ngModel",i.portfolio),e.R7$(4),e.R50("ngModel",i.tradeDate),e.R7$(4),e.R50("ngModel",i.dealStatus),e.R7$(2),e.Y8G("columnDefs",i.columnDefs)("rowData",i.rows)("defaultColDef",i.defaultColDef)("gridOptions",i.gridOptions),e.R7$(),e.Aen(e.lJ4(14,_)),e.R50("visible",i.showDialog),e.Y8G("modal",!0),e.R7$(),e.Y8G("ngIf",i.selected))},dependencies:[u.MD,u.bT,u.TG,s.YN,s.me,s.BC,s.vS,F.xs,h.P,h.l,k.Ei,m.tm],encapsulation:2})}}return a})()}}]);