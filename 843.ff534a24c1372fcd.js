"use strict";(self.webpackChunkhedge_accounting_sfx=self.webpackChunkhedge_accounting_sfx||[]).push([[843],{843:(j,u,d)=>{d.r(u),d.d(u,{ApportionmentTableComponent:()=>C});var c=d(467),p=d(177),s=d(4341),v=d(9641),h=d(1570),f=d(1141),e=d(4438),g=d(7129);let F=(()=>{class l{constructor(){this.table="allocation_engine"}list(t){var a=this;return(0,c.A)(function*(){try{let o=(0,g.b)().from(a.table).select("*").order("created_date",{ascending:!1}).limit(1e3);if(t?.search?.trim()){const r=t.search.trim();o=o.or(`allocation_id.ilike.%${r}%,request_id.ilike.%${r}%,entity_id.ilike.%${r}%,currency_code.ilike.%${r}%`)}t?.status&&(o=o.eq("allocation_status",t.status)),t?.executionDate&&(o=o.eq("execution_date",t.executionDate)),t?.navType&&(o=o.eq("nav_type",t.navType));const{data:n,error:m}=yield o;if(m)throw m;return n||[]}catch(i){return console.error("Failed to load allocation_engine",i),[]}})()}subscribeRealtime(t){try{const a=(0,g.b)();this.channel=a.channel("allocation_engine_changes").on("postgres_changes",{event:"*",schema:"public",table:this.table},()=>t()).subscribe()}catch(a){console.warn("Realtime subscription unavailable for allocation_engine",a)}}static{this.\u0275fac=function(a){return new(a||l)}}static{this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})();var _=d(5779);const b=()=>({width:"100vw",height:"95vh","max-width":"100vw","max-height":"95vh","border-top-left-radius":"16px","border-top-right-radius":"16px"});function y(l,E){if(1&l&&(e.j41(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"div",21),e.EFF(5,"Identifiers"),e.k0s()(),e.j41(6,"div",22)(7,"div")(8,"div",23),e.EFF(9,"Allocation ID"),e.k0s(),e.j41(10,"div",24),e.EFF(11),e.k0s()(),e.j41(12,"div")(13,"div",23),e.EFF(14,"Request ID"),e.k0s(),e.j41(15,"div",25),e.EFF(16),e.k0s()(),e.j41(17,"div")(18,"div",23),e.EFF(19,"Entity"),e.k0s(),e.j41(20,"div",24),e.EFF(21),e.k0s()(),e.j41(22,"div")(23,"div",23),e.EFF(24,"Currency"),e.k0s(),e.j41(25,"div",24),e.EFF(26),e.k0s()(),e.j41(27,"div")(28,"div",23),e.EFF(29,"NAV Type"),e.k0s(),e.j41(30,"div",24),e.EFF(31),e.k0s()()()()(),e.j41(32,"div",18)(33,"div",19)(34,"div",20)(35,"div",21),e.EFF(36,"Metrics"),e.k0s()(),e.j41(37,"div",22)(38,"div")(39,"div",23),e.EFF(40,"SFX Position"),e.k0s(),e.j41(41,"div",24),e.EFF(42),e.k0s()(),e.j41(43,"div")(44,"div",23),e.EFF(45,"Hedged Position"),e.k0s(),e.j41(46,"div",24),e.EFF(47),e.k0s()(),e.j41(48,"div")(49,"div",23),e.EFF(50,"Unhedged Position"),e.k0s(),e.j41(51,"div",24),e.EFF(52),e.k0s()(),e.j41(53,"div")(54,"div",23),e.EFF(55,"Available for Hedging"),e.k0s(),e.j41(56,"div",24),e.EFF(57),e.k0s()(),e.j41(58,"div")(59,"div",23),e.EFF(60,"Hedge Allocation"),e.k0s(),e.j41(61,"div",24),e.EFF(62),e.k0s()(),e.j41(63,"div")(64,"div",23),e.EFF(65,"Buffer %"),e.k0s(),e.j41(66,"div",24),e.EFF(67),e.k0s()(),e.j41(68,"div")(69,"div",23),e.EFF(70,"Buffer Amount"),e.k0s(),e.j41(71,"div",24),e.EFF(72),e.k0s()(),e.j41(73,"div")(74,"div",23),e.EFF(75,"CAR Amount Distribution"),e.k0s(),e.j41(76,"div",24),e.EFF(77),e.k0s()(),e.j41(78,"div")(79,"div",23),e.EFF(80,"Manual Overlay Amount"),e.k0s(),e.j41(81,"div",24),e.EFF(82),e.k0s()()()()(),e.j41(83,"div",18)(84,"div",19)(85,"div",20)(86,"div",21),e.EFF(87,"Execution & Status"),e.k0s()(),e.j41(88,"div",22)(89,"div")(90,"div",23),e.EFF(91,"Execution Date"),e.k0s(),e.j41(92,"div",24),e.EFF(93),e.k0s()(),e.j41(94,"div")(95,"div",23),e.EFF(96,"Allocation Status"),e.k0s(),e.j41(97,"div",24),e.EFF(98),e.k0s()(),e.j41(99,"div")(100,"div",23),e.EFF(101,"CAR Exemption"),e.k0s(),e.j41(102,"div",24),e.EFF(103),e.k0s()()()()(),e.j41(104,"div",18)(105,"div",19)(106,"div",20)(107,"div",21),e.EFF(108,"Notes"),e.k0s()(),e.j41(109,"div",26)(110,"div",27),e.EFF(111),e.k0s()()()()()),2&l){const t=e.XpG();e.R7$(11),e.JRh(t.selected.allocation_id),e.R7$(5),e.JRh(t.selected.request_id),e.R7$(5),e.JRh(t.selected.entity_id),e.R7$(5),e.JRh(t.selected.currency_code),e.R7$(5),e.JRh(t.selected.nav_type),e.R7$(11),e.JRh(t.selected.sfx_position),e.R7$(5),e.JRh(t.selected.hedged_position),e.R7$(5),e.JRh(t.selected.unhedged_position),e.R7$(5),e.JRh(t.selected.available_amount_for_hedging),e.R7$(5),e.JRh(t.selected.hedge_amount_allocation),e.R7$(5),e.JRh(t.selected.buffer_percentage),e.R7$(5),e.JRh(t.selected.buffer_amount),e.R7$(5),e.JRh(t.selected.car_amount_distribution),e.R7$(5),e.JRh(t.selected.manual_overlay_amount),e.R7$(11),e.JRh(t.selected.execution_date),e.R7$(5),e.JRh(t.selected.allocation_status),e.R7$(5),e.JRh(t.selected.car_exemption_flag),e.R7$(8),e.JRh(t.selected.notes)}}function R(l,E){if(1&l){const t=e.RV6();e.j41(0,"div",28)(1,"button",29),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showDialog=!1)}),e.EFF(2,"Close"),e.k0s()()}}let C=(()=>{class l{constructor(t){this.svc=t,this.rows=[],this.search="",this.status=null,this.executionDate=null,this.navType=null,this.showDialog=!1,this.selected=null,this.columnDefs=[{field:"allocation_id",headerName:"Allocation ID",width:160},{field:"request_id",headerName:"Request ID",width:160},{field:"entity_id",headerName:"Entity",width:140},{field:"currency_code",headerName:"Currency",width:100},{field:"nav_type",headerName:"NAV Type",width:120},{field:"execution_date",headerName:"Execution",width:130},{field:"allocation_status",headerName:"Status",width:120},{field:"hedged_position",headerName:"Hedged",width:120,type:"numericColumn"},{field:"unhedged_position",headerName:"Unhedged",width:120,type:"numericColumn"},{field:"available_amount_for_hedging",headerName:"Avail Hedge",width:140,type:"numericColumn"},{field:"hedge_amount_allocation",headerName:"Alloc Hedge",width:140,type:"numericColumn"},{field:"buffer_percentage",headerName:"Buffer %",width:110},{field:"buffer_amount",headerName:"Buffer Amt",width:120,type:"numericColumn"},{field:"car_amount_distribution",headerName:"CAR Dist",width:120,type:"numericColumn"},{field:"manual_overlay_amount",headerName:"Overlay",width:120,type:"numericColumn"},{field:"notes",headerName:"Notes",flex:1},{headerName:"Actions",width:100,pinned:"right",cellRenderer:a=>{const i=document.createElement("button");return i.className="text-gray-500 hover:text-blue-600 p-1",i.title="View Details",i.innerHTML='<i class="pi pi-eye"></i>',i.addEventListener("click",()=>a.context.componentParent.viewRow(a.data)),i}}],this.defaultColDef={resizable:!0,sortable:!0,filter:"agSetColumnFilter",minWidth:100},this.gridOptions={pagination:!0,paginationPageSize:25,animateRows:!0,context:{componentParent:this}}}ngOnInit(){this.load(),this.svc.subscribeRealtime(()=>this.load())}load(){var t=this;return(0,c.A)(function*(){t.rows=yield t.svc.list({search:t.search||void 0,status:t.status||void 0,executionDate:t.executionDate||void 0,navType:t.navType||void 0}),setTimeout(()=>t.gridApi?.sizeColumnsToFit(),50)})()}onGridReady(t){this.gridApi=t.api,t.api.sizeColumnsToFit()}viewRow(t){this.selected=t,this.showDialog=!0}onResize(){setTimeout(()=>this.gridApi?.sizeColumnsToFit(),100)}static{this.\u0275fac=function(a){return new(a||l)(e.rXU(F))}}static{this.\u0275cmp=e.VBU({type:l,selectors:[["app-operations-apportionment-table"]],hostBindings:function(a,i){1&a&&e.bIt("resize",function(){return i.onResize()},!1,e.tSv)},standalone:!0,features:[e.aNF],decls:29,vars:14,consts:[[1,"p-6","h-full","flex","flex-col"],[1,"mb-6"],[1,"text-xl","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"filter-bar"],[1,"filter-row","w-full"],[1,"flex","items-center","space-x-2"],[1,"filter-label"],["placeholder","allocation_id, request_id, entity, currency",1,"filter-input","w-72",3,"ngModelChange","ngModel"],["placeholder","e.g., Completed",1,"filter-input","w-48",3,"ngModelChange","ngModel"],["type","date",1,"filter-input",3,"ngModelChange","ngModel"],["placeholder","e.g., Trading",1,"filter-input","w-40",3,"ngModelChange","ngModel"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200",2,"height","600px"],[1,"ag-theme-alpine","w-full",2,"width","100%","height","100%",3,"gridReady","columnDefs","rowData","defaultColDef","gridOptions"],["header","Allocation Details","styleClass","entity-dialog entity-dialog-full",3,"visibleChange","visible","modal"],["class","space-y-4 p-2",4,"ngIf"],["pTemplate","footer"],[1,"space-y-4","p-2"],[1,"rounded-lg","border","border-gray-200","p-4","bg-white"],[1,"grid","grid-cols-12","gap-4"],[1,"col-span-12","md:col-span-3"],[1,"text-sm","font-semibold","text-gray-700"],[1,"col-span-12","md:col-span-9","grid","grid-cols-1","md:grid-cols-2","gap-3","text-sm"],[1,"text-gray-500"],[1,"font-medium"],[1,"font-mono"],[1,"col-span-12","md:col-span-9"],[1,"bg-gray-50","border","rounded","p-3","whitespace-pre-wrap","text-sm"],[1,"flex","justify-end","space-x-3","pt-4","border-t","border-gray-200"],[1,"btn","btn-secondary",3,"click"]],template:function(a,i){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3,"Apportionment Table"),e.k0s(),e.j41(4,"p",3),e.EFF(5,"Live from allocation_engine (Supabase)"),e.k0s()(),e.j41(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),e.EFF(10,"Search:"),e.k0s(),e.j41(11,"input",8),e.mxI("ngModelChange",function(n){return e.DH7(i.search,n)||(i.search=n),n}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(12,"div",6)(13,"label",7),e.EFF(14,"Status:"),e.k0s(),e.j41(15,"input",9),e.mxI("ngModelChange",function(n){return e.DH7(i.status,n)||(i.status=n),n}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(16,"div",6)(17,"label",7),e.EFF(18,"Execution Date:"),e.k0s(),e.j41(19,"input",10),e.mxI("ngModelChange",function(n){return e.DH7(i.executionDate,n)||(i.executionDate=n),n}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()(),e.j41(20,"div",6)(21,"label",7),e.EFF(22,"NAV Type:"),e.k0s(),e.j41(23,"input",11),e.mxI("ngModelChange",function(n){return e.DH7(i.navType,n)||(i.navType=n),n}),e.bIt("ngModelChange",function(){return i.load()}),e.k0s()()()(),e.j41(24,"div",12)(25,"ag-grid-angular",13),e.bIt("gridReady",function(n){return i.onGridReady(n)}),e.k0s()(),e.j41(26,"p-dialog",14),e.mxI("visibleChange",function(n){return e.DH7(i.showDialog,n)||(i.showDialog=n),n}),e.DNE(27,y,112,18,"div",15)(28,R,3,0,"ng-template",16),e.k0s()()),2&a&&(e.R7$(11),e.R50("ngModel",i.search),e.R7$(4),e.R50("ngModel",i.status),e.R7$(4),e.R50("ngModel",i.executionDate),e.R7$(4),e.R50("ngModel",i.navType),e.R7$(2),e.Y8G("columnDefs",i.columnDefs)("rowData",i.rows)("defaultColDef",i.defaultColDef)("gridOptions",i.gridOptions),e.R7$(),e.Aen(e.lJ4(13,b)),e.R50("visible",i.showDialog),e.Y8G("modal",!0),e.R7$(),e.Y8G("ngIf",i.selected))},dependencies:[p.MD,p.bT,s.YN,s.me,s.BC,s.vS,v.xs,h.P,h.l,_.Ei,f.tm],encapsulation:2})}}return l})()}}]);